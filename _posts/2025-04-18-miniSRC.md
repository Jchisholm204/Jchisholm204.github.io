---
title: MiniSRC CPU Design
date: 2025-04-18
categories: [HDL]
tags: [Verilog, FPGA]
author: [Jacob, Hendrix, Luke, Matt]
image:
  path: /assets/miniSRC/datapath.drawio.svg
  alt: MiniSRC Datapath
---

This report presents the design, implementation, and evaluation of the MiniSRC CPU, 
a 32-bit RISC-based processor architecture supporting integer arithmetic, including multiplication and division.

## Project Specification
The CPU consists of 32 registers and uses an instruction format similar to the NIOS II processor. The registers and their purposes are shown below:
- PC<31..0>: 32-bit Program Counter (PC)
- IR<31..0>: 32-bit Instruction Register (IR)
- R[0..15]<31..0>: 16 32-bit registers, named R[0] through R[15]
- R[0]<31..0>: 1 Constant zero register
- R[1..7]<31..0>: 7 General-Purpose Registers
- R[8]<31..0>: Return Address Register (RA)
- R[9]<31..0>: Stack Pointer (SP)
- R[10..13]<31..0>: Four Argument Registers
- R[14..15]<31..0]: Two Return Value Registers
- RASH<31..0>: (Register ALU Storage Hi) 32-bit Register dedicated to keep the high-order word of a Multiplication product, or the Remainder of a Division operation 
- RASL<31..0>: (Register ALU Storage Low) 32-bit Register dedicated to keep the low-order word of a Multiplication product, or the Quotient of a Division operation

### Instruction Set Specification
The MiniSRC instruction set consists of five instruction formats.
The R and I formats are used for Arithmetic and Logic Unit (ALU) operations, while the J and B instruction formats are used for jumps and branches.
The M format is used for special instruction such as halt.
Instruction formats are shown below:

```verilog
// R Type instruction macro
`define INS_R(code, ra, rb, rc) {code, ra, rb, rc, 15'd0}

// I Type instruction macro
// 19 bit constant C
`define INS_I(code, ra, rb, c) {code, ra, rb, c}

// B Type instruction macro
// 19 bit constant C
// 4 bit constant c2
`define INS_B(code, ra, c2, c) {code, ra, 2'b00, c2, c}

// J Type instruction macro
`define INS_J(code, ra) {code, ra, 23'd0}

// M Type instruction macro
`define INS_M(code) {code, 27'd0}
```

## Processor Design
The original MiniSRC processor follows a bus-based architecture.
The following section details the design of a 5-stage pipeline that adheres to the functionality of the MiniSRC instruction set architecture.

### 5-Stage Datapath
The datapath is a conventional 5-stage pipeline consisting of a register file, ALU, and several intermediate registers and multiplexers.
Shown below is the pipeline diagram:

![](/assets/miniSRC/datapath.drawio.svg)

#### Register File
The register file contains 15 registers marked 0 through 15. The zero register is always zero.
Each register can store up to one word (32 bits).
The register file has two read ports and one write port.
The read ports are multiplexed via an and/or network using two 4 to 16 decoder.
The write addressed is decoded via a 4 to 16 demultiplexer used as the register load enable.
The functional diagram of the register file is shown below:
![](/assets/miniSRC/reg_file.svg)
### ALU Design
The ALU, or Arithmetic Logic Unit, takes in the three inputs, A and B, along with the control input and produces the high/low results based on the control input.
In addition to containing a multiplexer to select between possible outputs, the ALU also contains small logical elements to manipulate the inputs to the adder and divisor units.
If the control input is given as negate, the ALU will swap the inputs to the carry-lookahead adder to subtract the input from zero. 
Additionally, if either input carries a negative sign, the ALU will manipulate the inputs and outputs to ensure the correct signage.